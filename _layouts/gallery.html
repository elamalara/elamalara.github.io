<!DOCTYPE html>
<html>

  {% include head.html %}

  <body class="galleryPage">

      {% assign category = site.data.categories[page.category] %}

      <header class="site-navigation">
        <ul>
          <li ><a href="{{ site.url }}">Elizabeth MALARA</a></li>
          {% for availableCategory in site.data.categories %}
            <li ><a href="/{{ availableCategory.[1].internal | prepend: site.baseurl }}">{{ availableCategory.[1].title }}</a></li>
          {% endfor %}
          <li >Browsing {{ category.title }}</li>
        </ul>
      </header>

      <nav>
        <ul>
        {% for art in category.pieces %}
          <li style="background-image: url({{ art.url | prepend: site.baseurl }});" > <a href="{{ art.internal }}"></a> </li>
        {% endfor %}
        </ul>
      </nav>

      {{ content }}

      {% for art in category.pieces %}
      <a id="{{ art.internal }}"></a>
      <article> <figure style="background-image: url({{ art.url | prepend: site.baseurl }});" ><img src="{{ art.url | prepend: site.baseurl }}" /></figure> <section><h3>{{ art.title }}</h3><p>{{ art.description }}</p></section></article>

      {% endfor %}

      <a class="navigation previous" href="#">&lt;</a>
      <a class="navigation next" href="#">&gt;</a>
  </body>

  <script>
  $(function() {

    var currentElement = -1;

    function getCurrentElement() {
      var currentPosition = $('html').scrollTop();
      var elementHeight = $('.galleryPage>nav').height();
      console.log(currentPosition + "; " + (currentPosition + elementHeight * 0.5) + " / " + elementHeight + " = " + Math.floor((currentPosition + elementHeight * 0.5) / elementHeight));
      return Math.floor((currentPosition + elementHeight * 0.5) / elementHeight);
    }

    function getElementY(index) {
      var elementHeight = $('.galleryPage>nav').height();
      return index * elementHeight;
    }

    $(window).scroll(function(e) {
      var newElement = getCurrentElement();
      if (newElement != currentElement)
      {
        currentElement = newElement;
        var elementParent = $( '.galleryPage>nav>ul>li').eq(newElement);
        //var elementDescription = elementParent.children('section').html();
        elementParent.stop().fadeOut(300).fadeIn(300);
        setTimeout(function() {
          elementParent.css('background: red;');
        }, 300);
      }
    });

    function scrollToElement(href) {
      console.log(href);
      $('html, body').stop().animate({
          scrollTop: $( href ).offset().top
      }, 600, function () {
        window.location.hash = href;
      });
    }

    $('.previous').click(function(e){
      e.preventDefault();
      var href = '#i' + (getCurrentElement() + 1 - 1);
      scrollToElement(href);
      return false;
    });

    $('.next').click(function(e){
      e.preventDefault();
      var href = '#i' + (getCurrentElement() + 1 + 1);
      scrollToElement(href);
      return false;
    });

    $('nav a').click(function(e){
      e.preventDefault();
      var href = $.attr(this, 'href');
      scrollToElement(href);
      return false;
    });

  });
  </script>

</html>

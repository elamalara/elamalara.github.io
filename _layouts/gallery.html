<!DOCTYPE html>
<html>

  {% include head.html %}

  <body class="galleryPage">

      {% assign category = site.data.categories[page.category] %}

      <nav id="siteNavigation">
        <ul>
          <li 
            {% if category.internal == 'featured' %}
              class="active"
            {% endif %}
            ><a href="{{ site.url }}">Elizabeth MALARA </a></li>
          {% for availableCategory in site.data.categories %}
            {% unless availableCategory.[1].hideinmenu %}
            <li 
            {% if category.internal == availableCategory.[1].internal %}
              class="active"
            {% endif %}
            ><a href="/{{ availableCategory.[1].internal | prepend: site.baseurl }}">{{ availableCategory.[1].title }}</a></li>
            {% endunless %}
          {% endfor %}
        </ul>
      </nav>

      <div id="thumbnailNavigation">
        <ul>
        {% for art in category.pieces %}
          {% if art.absoluteurl %}
            {% capture image-url %}{{ art.absoluteurl }}{% endcapture %}
          {% else %}
            {% capture image-url %}/images/{{category.internal}}/{{ art.url }}{% endcapture %}
          {% endif %}
          <li style="background-image: url('{{ image-url }}');" > <a href="#{{ art.internal }}"></a> </li>
        {% endfor %}
        </ul>
      </div>

    {% capture testing %}Ahh just debugging{% endcapture %}
      <article>
        <section>
          <h3>{{ category.title }}</h3>
          {{ testing }}
        </section>
      </article>

      {% for art in category.pieces %}
          {% if art.absoluteurl %}
          Absolute URL given {{ art }} 
            {% capture image-url %}{{ art.absoluteurl }}{% endcapture %}
          {% else %}
          Regular URL given {{ art }} <b>/images/{{category.internal}}/{{ art.url }}</b>
            {% capture image-url %}/images/{{category.internal}}/{{ art.url }}{% endcapture %}
          {% endif %}
      <a id="{{ art.internal }}"></a>
      <article> <figure style="background-image: url('{{ testing }}');" ><img src=" {{ testing }}" /></figure> <section><h3>{{ art.title }}</h3><p>
      {% if art.description != 'Please write a brief description.' %}
        {{ art.description }}
      {% endif %}
      {{ testing }}
      </p></section></article>

      {% endfor %}

      <a class="tapNavigation previous" href="#"></a>
      <a class="tapNavigation next" href="#"></a>
  </body>

  <script>
  $(function() {

    var currentElement = -1;

    function getCurrentElement() {
      var currentPosition = $('html').scrollTop();
      var elementHeight = $('#thumbnailNavigation').height() + 50;
      console.log(currentPosition + "; " + (currentPosition + elementHeight * 0.5) + " / " + elementHeight + " = " + Math.floor((currentPosition + elementHeight * 0.5) / elementHeight));
      return Math.floor((currentPosition) / elementHeight); // add one to acommodate for the intro
    }

    function getElementY(index) {
      var elementHeight = $('#thumbnailNavigation').height() + 50;
      return index * elementHeight;
    }

    $(window).scroll(function(e) {
      var newElement = getCurrentElement();
      if (newElement != currentElement)
      {
        currentElement = newElement;
        var elementParent = $( '#thumbnailNavigation>ul>li').eq(newElement);
        //var elementDescription = elementParent.children('section').html();
        elementParent.stop().fadeOut(300).fadeIn(300);
        setTimeout(function() {
          elementParent.css('background: red;');
        }, 300);
      }
    });

    function scrollToElement(href) {
      console.log(href);
      $('html, body').stop().animate({
          scrollTop: $( href ).offset().top
      }, 600, function () {
        window.location.hash = href;
      });
    }

    $('.previous').click(function(e){
      e.preventDefault();
      var id = getCurrentElement() - 1;
      if (id < 0)
        return;
      console.log(id);
      var thumb = $( '#thumbnailNavigation>ul>li').eq(id);
      console.log(thumb);
      var link = thumb.find('a');
      console.log(link);
      var href = link.attr('href');
      console.log(href);
      scrollToElement(href);
      return false;
    });

    $('.next').click(function(e){
      e.preventDefault();
      var id = getCurrentElement() + 1;
      console.log(id);
      if (id >= $( '#thumbnailNavigation>ul>li').length)
        id = 0;
      var thumb = $( '#thumbnailNavigation>ul>li').eq(id);
      console.log(thumb);
      var link = thumb.find('a');
      console.log(link);
      var href = link.attr('href');
      console.log(href);
      scrollToElement(href);
      return false;
    });

    $('#thumbnailNavigation a').click(function(e){
      e.preventDefault();
      var href = $.attr(this, 'href');
      scrollToElement(href);
      return false;
    });

  });
  </script>

</html>
